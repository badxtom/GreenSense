<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GreenSense</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css">
  <link rel="icon" type="image/png" href="plant.png">
  <link rel="stylesheet" type="text/css" href="style2.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      background-color: #f0f0f0;
      transition: background-color 0.5s ease;
      position: relative;
      min-height: 100vh;
    }

    .topnav {
      background-color: #04aa2e;
      overflow: hidden;
      padding: 10px;
      text-align: center;
    }

    .topnav h1 {
      color: white;
      margin: 0;
      text-align: right;
    }

    .container {
      max-width: 800px;
      margin: 20px auto;
      background-color: #fff;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    h2 {
      text-align: center;
      margin-bottom: 10px;
      color: #333;
    }

    .card {
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .icon {
      font-size: 36px;
      margin-bottom: 10px;
    }

    .value {
      font-size: 24px;
      font-weight: bold;
    }

    .unit {
      font-size: 16px;
      color: #888;
    }

    #dashboard {
      display: flex;
      justify-content: space-around;
      flex-wrap: wrap;
    }

    .dashboard-item {
      width: 45%;
      background-color: #f9f9f9;
      padding: 20px;
      border-radius: 10px;
      box-shadow: 0 0 5px rgba(0, 0, 0, 0.1);
      margin-bottom: 20px;
    }

    .button-container {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }

    .button-container button {
      background-color: #04aa2e;
      color: white;
      border: none;
      padding: 15px 30px;
      margin: 0 10px;
      border-radius: 10px;
      cursor: pointer;
      transition: background-color 0.3s ease;
      font-size: 18px;
      outline: none;
    }

    .button-container button:hover {
      background-color: #087f21;
    }

    .switch-container {
      position: fixed;
      bottom: 20px;
      right: 20px;
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
      border-radius: 34px;
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
      border-radius: 50%;
    }

    input:checked+.slider {
      background-color: #04aa2e;
    }

    input:focus+.slider {
      box-shadow: 0 0 1px #04aa2e;
    }

    input:checked+.slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }

    .slider.round {
      border-radius: 34px;
    }

    .slider.round:before {
      border-radius: 50%;
    }

    body.dark-mode {
      background-color: #333;
      color: #fff;
    }

    .button-container button.dark-mode {
      background-color: #444;
    }

    .button-container button.dark-mode:hover {
      background-color: #555;
    }

    .switch.dark-mode .slider {
      background-color: #666;
    }

    .switch.dark-mode input:checked+.slider {
      background-color: #2196F3;
    }

    .switch.dark-mode input:focus+.slider {
      box-shadow: 0 0 1px #2196F3;
    }

    .switch .slider:before {
      font-size: 20px;
      color: #444;
      position: absolute;
      top: 4px;
      left: 4px;
    }

    .switch input:checked+.slider:before {
      content: "üåô";
    }

    .switch input:not(:checked)+.slider:before {
      content: "‚òÄÔ∏è";
    }

    label {
      color: #000;

    }
    span {
      color: #000;

      
    }

  </style>

  <script>
    window.addEventListener('DOMContentLoaded', () => {
      const userCreds = sessionStorage.getItem("user-creds");
      if (!userCreds && window.location.pathname.includes('home')) {
        window.location.href = 'login';
      }

    });
  </script>
  <script src="env.js"></script>
</head>

<body>
  <div class="topnav">
    <h1>GreenSense Dashboard <i class="fas fa-seedling"></i></h1>
  </div>
  <nav>
    <form class="d-flex" role="search" style="text-align: right;">
      <button class="btn btn-outline-success" type="button" id="signoutbutton">Cerrar Sesi√≥n</button>
      <!-- <button class="btn btn-outline-success" type="button" id="wifiButton">WI-FI</button> -->
    </form>
  </nav>
  <h2 id="msg"></h2>
  <h2 id="greet"></h2>

  <div class="container">
    <h2>Niveles del Invernadero</h2>
    <div class="button-container">

      <button id="level1" class="btn-level">Nivel 1</button>
      <button id="level2" class="btn-level">Nivel 2</button>
      <button id="level3" class="btn-level">Nivel 3</button>
    </div>
    <div class="button-container">
      <div class="switch-container">
        <label class="switch">
          <input type="checkbox" id="darkModeSwitch">
          <span class="slider round"></span>
        </label>
      </div>
    </div>
  </div>

  <!-- <form id="wifiForm" class="container" style="display: none;" novalidate>
    <h2>Configuraci√≥n de WI-FI</h2>
    <div class="form-group">
      <label for="lastNetwork">√öltima red:</label>
      <span id="lastNetwork">Cargando...</span>
      <i class="fas fa-wifi" style="margin-left: 5px; color:#000"></i>    </div>
    <div class="form-group">
      <label for="ssid">SSID</label>
      <input type="text" id="ssid" class="form-control" placeholder="Nombre" style="width: 200px;" required>
    </div>
    <div class="form-group">
      <label for="password">Contrase√±a</label>
      <input type="password" id="password" class="form-control" placeholder="Contrase√±a" style="width: 200px;" required>
    </div>
    <div class="button-container">
      <button id="saveWifiButton" class="btn btn-success">Guardar</button>
      <button id="cancelWifiButton" class="btn btn-danger">Cancelar</button>
    </div>
  </form> -->
  


  <script type="module">
    let UserCreds = JSON.parse(sessionStorage.getItem("user-creds"));
    let UserInfo = JSON.parse(sessionStorage.getItem("user-info"));

    let GreetHead = document.getElementById('greet');
    let SignoutBtn = document.getElementById('signoutbutton');
    let DarkModeSwitch = document.getElementById('darkModeSwitch');
    let Level1Btn = document.getElementById('level1');
    let Level2Btn = document.getElementById('level2');
    let Level3Btn = document.getElementById('level3');
    // let WifiButton = document.getElementById('wifiButton');
    // let WifiForm = document.getElementById('wifiForm');
    // let SaveWifiButton = document.getElementById('saveWifiButton');
    // let CancelWifiButton = document.getElementById('cancelWifiButton');

    let isDarkModeEnabled = false;

    GreetHead.innerText = `Bienvenido ${UserInfo.firstname + " " + UserInfo.lastname}!`;

    let Signout = () => {
      sessionStorage.removeItem("user-creds");
      sessionStorage.removeItem("user-info");
      // localStorage.removeItem('darkModeEnabled');
      window.location.href = 'login';
    }

    let CheckCred = () => {
      if (!sessionStorage.getItem("user-creds"))
        window.location.href = 'login';
      else {
        GreetHead.innerText = `Bienvenid@ ${UserInfo.firstname + " " + UserInfo.lastname}!`;
      }
    }

    window.addEventListener('load', () => {
      CheckCred();
      loadDarkModePreference();
      adjustTextColor();
    });

    SignoutBtn.addEventListener('click', Signout);

    // WifiButton.addEventListener('click', () => {
    //   WifiForm.style.display = 'block';
    // });

    // SaveWifiButton.addEventListener('click', async () => {
    //   event.preventDefault();
    //   await saveWifiSettings();
    // });

    // CancelWifiButton.addEventListener('click', () => {
    //   WifiForm.style.display = 'none';
    // });

    function saveDarkModePreference() {
      localStorage.setItem('darkModeEnabled', document.body.classList.contains('dark-mode'));
    }

    function loadDarkModePreference() {
      const darkModeEnabled = localStorage.getItem('darkModeEnabled');
      isDarkModeEnabled = darkModeEnabled === 'true';
      if (isDarkModeEnabled) {
        document.body.classList.add('dark-mode');
        DarkModeSwitch.checked = true;
      } else {
        document.body.classList.remove('dark-mode');
        DarkModeSwitch.checked = false;
      }
    }
    window.addEventListener('load', () => {
      loadDarkModePreference();
    });

    function adjustTextColor() {
      if (isDarkModeEnabled) {
        GreetHead.style.color = '#FFF';
      } else {
        GreetHead.style.color = '#333';
      }
    }

    DarkModeSwitch.addEventListener('change', () => {
      document.body.classList.toggle('dark-mode');
      isDarkModeEnabled = document.body.classList.contains('dark-mode');
      saveDarkModePreference();
      adjustTextColor();

      const state = isDarkModeEnabled ? 'on' : 'off';
      saveSwitchState(state);
    });

    Level1Btn.addEventListener('click', () => {
      localStorage.setItem('lastVisitedPage', 'n1');
      window.location.href = 'n1';
    });
    Level2Btn.addEventListener('click', () => {
      window.location.href = 'n2';
    });
    Level3Btn.addEventListener('click', () => {
      window.location.href = 'n3';
    });

    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-analytics.js";
    import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: window.env.API_KEY,
      authDomain: window.env.AUTH_DOMAIN,
      databaseURL: window.env.DATABASE_URL,
      projectId: window.env.PROJECT_ID,
      storageBucket: window.env.STORAGE_BUCKET,
      messagingSenderId: window.env.MESSAGING_SENDER_ID,
      appId: window.env.APP_ID,
      measurementId: window.env.MEASUREMENT_ID
    };

    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics();
    const db = getFirestore();

    async function saveSwitchState() {
      const switchState = document.getElementById('darkModeSwitch').checked;

      try {
        const switchRef = doc(db, "Settings", "switchState");
        await setDoc(switchRef, { switchState });
      } catch (error) {
        console.error("Error al guardar el estado del switch en Firestore:", error);
      }
    }

    // async function saveWifiSettings() {
    //   const ssid = document.getElementById('ssid').value.trim();
    //   const password = document.getElementById('password').value.trim();

    //   if (ssid === '' || password === '') {
    //     alert('Por favor, completar todos los campos.');
    //     return;
    //   }

    //   try {
    //     const wifiRef = doc(db, "Settings", "WIFI");
    //     await setDoc(wifiRef, { ssid, password });
    //     console.log("Configuraci√≥n de WI-FI guardada correctamente en Firestore.");
    //     location.reload();
    //   } catch (error) {
    //     console.error("Error al guardar la configuraci√≥n de WI-FI en Firestore:", error);
    //   }
    // }

    // async function getLastNetwork() {
    //   const wifiRef = doc(db, "Settings", "WIFI");
    //   const docSnap = await getDoc(wifiRef);
    //   if (docSnap.exists()) {
    //     const data = docSnap.data();
    //     return data.ssid || "Sin configurar";
    //   } else {
    //     return "Sin configurar";
    //   }
    // }

    // window.addEventListener('DOMContentLoaded', async () => {
    //   const lastNetworkSpan = document.getElementById("lastNetwork");
    //   const lastNetworkName = await getLastNetwork();
    //   lastNetworkSpan.textContent = lastNetworkName;
    // });

  </script>
</body>

</html>